# CREATIVE PHASE: Language-Specific Prompt Generation Algorithm

## üé® CREATIVE PHASE: ALGORITHM DESIGN

### PROBLEM STATEMENT
–ù—É–∂–Ω–æ —Å–ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –∞–ª–≥–æ—Ä–∏—Ç–º –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —è–∑—ã–∫–æ–≤–æ-—Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã—Ö –ø—Ä–æ–º–ø—Ç–æ–≤ –¥–ª—è AI, –∫–æ—Ç–æ—Ä—ã–π –±—É–¥–µ—Ç —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ –≤—ã–±–∏—Ä–∞—Ç—å –ø–æ–¥—Ö–æ–¥—è—â–∏–π –ø—Ä–æ–º–ø—Ç –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —è–∑—ã–∫–∞, –æ–±–µ—Å–ø–µ—á–∏–≤–∞—Ç—å –∫–∞—á–µ—Å—Ç–≤–æ —Å–∞–º–º–∞—Ä–∏ –Ω–∞ —Ä–∞–∑–Ω—ã—Ö —è–∑—ã–∫–∞—Ö, –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –Ω–µ–ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ —è–∑—ã–∫–∏, –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞—Ç—å—Å—è –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –Ω–æ–≤—ã—Ö —è–∑—ã–∫–æ–≤ –∏ –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Ç–æ–∫–µ–Ω–æ–≤.

### ALGORITHM OPTIONS ANALYSIS

#### Option 1: Simple Switch-Case
**Description**: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø—Ä–æ—Å—Ç–æ–≥–æ switch-case –¥–ª—è –≤—ã–±–æ—Ä–∞ –ø—Ä–æ–º–ø—Ç–∞ –ø–æ —è–∑—ã–∫–æ–≤–æ–º—É –∫–æ–¥—É

**Pros**:
- –ü—Ä–æ—Å—Ç–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è
- –ë—ã—Å—Ç—Ä–∞—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
- –õ–µ–≥–∫–æ –ø–æ–Ω—è—Ç—å –∏ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—Ç—å
- –ú–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø–∞–º—è—Ç–∏

**Cons**:
- –°–ª–æ–∂–Ω–æ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞—Ç—å –¥–ª—è –±–æ–ª—å—à–æ–≥–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ —è–∑—ã–∫–æ–≤
- –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–¥–∞ –¥–ª—è –ø–æ—Ö–æ–∂–∏—Ö —è–∑—ã–∫–æ–≤
- –°–ª–æ–∂–Ω–æ –¥–æ–±–∞–≤–ª—è—Ç—å –Ω–æ–≤—ã–µ —è–∑—ã–∫–∏
- –ù–µ—Ç –≥–∏–±–∫–æ—Å—Ç–∏ –¥–ª—è —Å–ª–æ–∂–Ω—ã—Ö —Å–ª—É—á–∞–µ–≤

**Complexity**: O(1)
**Implementation Time**: 1 day

#### Option 2: Hierarchical System with Inheritance
**Description**: –°–æ–∑–¥–∞–Ω–∏–µ –∏–µ—Ä–∞—Ä—Ö–∏–∏ —è–∑—ã–∫–æ–≤ —Å –±–∞–∑–æ–≤—ã–º–∏ –ø—Ä–æ–º–ø—Ç–∞–º–∏ –∏ —Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–º–∏ –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è–º–∏

**Pros**:
- –•–æ—Ä–æ—à–∞—è –º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å
- –ü–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –∫–æ–¥–∞
- –õ–µ–≥–∫–æ –¥–æ–±–∞–≤–ª—è—Ç—å –Ω–æ–≤—ã–µ —è–∑—ã–∫–∏
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ —è–∑—ã–∫–æ–≤—ã—Ö —Å–µ–º–µ–π—Å—Ç–≤

**Cons**:
- –ë–æ–ª–µ–µ —Å–ª–æ–∂–Ω–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è
- –ë–æ–ª—å—à–µ –∫–æ–¥–∞ –¥–ª—è –ø–æ–¥–¥–µ—Ä–∂–∫–∏
- –ú–æ–∂–µ—Ç –±—ã—Ç—å –∏–∑–±—ã—Ç–æ—á–Ω—ã–º –¥–ª—è –ø—Ä–æ—Å—Ç—ã—Ö —Å–ª—É—á–∞–µ–≤
- –°–ª–æ–∂–Ω–µ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å

**Complexity**: O(log n)
**Implementation Time**: 3-4 days

#### Option 3: Hybrid Approach with Templates
**Description**: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —à–∞–±–ª–æ–Ω–æ–≤ –ø—Ä–æ–º–ø—Ç–æ–≤ —Å —è–∑—ã–∫–æ–≤–æ-—Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–º–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏

**Pros**:
- –ë–∞–ª–∞–Ω—Å –º–µ–∂–¥—É –ø—Ä–æ—Å—Ç–æ—Ç–æ–π –∏ –≥–∏–±–∫–æ—Å—Ç—å—é
- –õ–µ–≥–∫–æ –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞—Ç—å –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —è–∑—ã–∫–æ–≤
- –•–æ—Ä–æ—à–∞—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏—Ö –ø—Ä–æ–º–ø—Ç–æ–≤

**Cons**:
- –°—Ä–µ–¥–Ω—è—è —Å–ª–æ–∂–Ω–æ—Å—Ç—å —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏
- –ù—É–∂–Ω–æ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—Ç—å —à–∞–±–ª–æ–Ω—ã
- –ú–æ–∂–µ—Ç –±—ã—Ç—å —Å–ª–æ–∂–Ω–æ –¥–ª—è —Å–ª–æ–∂–Ω—ã—Ö —è–∑—ã–∫–æ–≤

**Complexity**: O(1)
**Implementation Time**: 2-3 days

### EVALUATION MATRIX

| Criterion | Option 1 | Option 2 | Option 3 |
|-----------|----------|----------|----------|
| Performance | 10/10 | 7/10 | 9/10 |
| Scalability | 3/10 | 9/10 | 8/10 |
| Maintainability | 4/10 | 8/10 | 7/10 |
| Flexibility | 2/10 | 9/10 | 8/10 |
| Implementation Time | 9/10 | 4/10 | 7/10 |
| Code Reusability | 2/10 | 9/10 | 7/10 |

### DECISION
**Selected: Option 3 - Hybrid Approach with Templates**

**Rationale**:
1. –û–ø—Ç–∏–º–∞–ª—å–Ω–∞—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å - O(1) —Å–ª–æ–∂–Ω–æ—Å—Ç—å
2. –•–æ—Ä–æ—à–∞—è –º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –Ω–æ–≤—ã—Ö —è–∑—ã–∫–æ–≤
3. –ì–∏–±–∫–æ—Å—Ç—å –¥–ª—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø—Ä–æ–º–ø—Ç–æ–≤ –ø–æ–¥ —Ä–∞–∑–Ω—ã–µ —è–∑—ã–∫–∏
4. –ë–∞–ª–∞–Ω—Å –º–µ–∂–¥—É –ø—Ä–æ—Å—Ç–æ—Ç–æ–π –∏ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å—é
5. –õ–µ–≥–∫–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –∏ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—Ç—å

### DETAILED ALGORITHM

#### Template Structure
```dart
class PromptTemplate {
  final String systemPrompt;
  final String userPrompt;
  final Map<String, String> variables;
  final String fallbackLanguage;
  
  const PromptTemplate({
    required this.systemPrompt,
    required this.userPrompt,
    required this.variables,
    this.fallbackLanguage = 'en',
  });
}
```

#### Language Configuration
```dart
class LanguageConfig {
  final String code;
  final String name;
  final String nativeName;
  final String promptTemplate;
  final Map<String, String> variables;
  final List<String> supportedFeatures;
  
  const LanguageConfig({
    required this.code,
    required this.name,
    required this.nativeName,
    required this.promptTemplate,
    required this.variables,
    required this.supportedFeatures,
  });
}
```

#### Core Algorithm
```dart
class LanguagePromptSelector {
  static const Map<String, LanguageConfig> _languageConfigs = {
    'en': LanguageConfig(
      code: 'en',
      name: 'English',
      nativeName: 'English',
      promptTemplate: 'summary_template',
      variables: {
        'action': 'Create',
        'format': 'comprehensive summary',
        'structure': 'Clear headings and subheadings',
      },
      supportedFeatures: ['markdown', 'latex', 'bullet_points'],
    ),
    'ru': LanguageConfig(
      code: 'ru',
      name: 'Russian',
      nativeName: '–†—É—Å—Å–∫–∏–π',
      promptTemplate: 'summary_template',
      variables: {
        'action': '–°–æ–∑–¥–∞–π—Ç–µ',
        'format': '–∫—Ä–∞—Ç–∫–æ–µ –∏–∑–ª–æ–∂–µ–Ω–∏–µ',
        'structure': '–ß–µ—Ç–∫–∏–µ –∑–∞–≥–æ–ª–æ–≤–∫–∏ –∏ –ø–æ–¥–∑–∞–≥–æ–ª–æ–≤–∫–∏',
      },
      supportedFeatures: ['markdown', 'latex', 'bullet_points'],
    ),
    // ... other languages
  };
  
  static String getPrompt(String language, String templateType) {
    // 1. Check language support
    final config = _languageConfigs[language];
    if (config == null) {
      return _getFallbackPrompt(templateType);
    }
    
    // 2. Get template
    final template = _getTemplate(config.promptTemplate, templateType);
    
    // 3. Replace variables
    return _replaceVariables(template, config.variables);
  }
  
  static String _getFallbackPrompt(String templateType) {
    return getPrompt('en', templateType);
  }
  
  static String _replaceVariables(String template, Map<String, String> variables) {
    String result = template;
    variables.forEach((key, value) {
      result = result.replaceAll('{{$key}}', value);
    });
    return result;
  }
}
```

#### Prompt Templates
```dart
class PromptTemplates {
  static const String summaryTemplate = '''
You are an expert at creating structured summaries of educational content, lectures, and discussions.

{{action}} a {{format}} in Markdown format with the following structure:
- {{structure}} using ## and ###
- Bullet points for key information using -
- Bold text for important concepts using **text**
- LaTeX formulas for mathematical expressions using \$formula\$
- Organized sections by topic
- Professional and educational tone

Format example:
## Main Topic
- Key point 1
- Key point 2

### Subsection
**Important concept**: Explanation

**Formula**: \$x^2 + y^2 = z^2\$

Focus on:
1. Main topics and themes
2. Key concepts and definitions
3. Important formulas and calculations
4. Action items or assignments
5. Questions or discussions raised

Make the summary comprehensive but concise, highlighting the most important information for future reference.
''';
}
```

### PERFORMANCE OPTIMIZATION

#### Caching Strategy
```dart
class PromptCache {
  static final Map<String, String> _cache = {};
  static const int _maxCacheSize = 100;
  
  static String getCachedPrompt(String language, String templateType) {
    final key = '${language}_$templateType';
    
    if (_cache.containsKey(key)) {
      return _cache[key]!;
    }
    
    final prompt = LanguagePromptSelector.getPrompt(language, templateType);
    
    // Cache with size limit
    if (_cache.length >= _maxCacheSize) {
      _cache.remove(_cache.keys.first);
    }
    
    _cache[key] = prompt;
    return prompt;
  }
  
  static void clearCache() {
    _cache.clear();
  }
}
```

#### Lazy Loading
```dart
class LazyPromptLoader {
  static final Map<String, LanguageConfig> _loadedConfigs = {};
  
  static LanguageConfig? getLanguageConfig(String language) {
    if (_loadedConfigs.containsKey(language)) {
      return _loadedConfigs[language];
    }
    
    // Load configuration only when needed
    final config = _loadLanguageConfig(language);
    if (config != null) {
      _loadedConfigs[language] = config;
    }
    
    return config;
  }
}
```

#### Preloading
```dart
class PromptPreloader {
  static Future<void> preloadPopularLanguages() async {
    const popularLanguages = ['en', 'ru', 'es', 'fr', 'de', 'ja', 'zh'];
    
    for (final language in popularLanguages) {
      await PromptCache.getCachedPrompt(language, 'summary');
    }
  }
}
```

### ERROR HANDLING

#### Error Handler
```dart
class PromptErrorHandler {
  static String handlePromptError(String language, String templateType, dynamic error) {
    // Log error
    print('Error generating prompt for $language: $error');
    
    // Fallback to English
    if (language != 'en') {
      return LanguagePromptSelector.getPrompt('en', templateType);
    }
    
    // Fallback to base prompt
    return PromptTemplates.summaryTemplate;
  }
}
```

#### Validation
```dart
class LanguageValidator {
  static const Set<String> _supportedLanguages = {
    'en', 'ru', 'es', 'fr', 'de', 'it', 'pt', 'ja', 'ko', 'zh',
    'ar', 'hi', 'th', 'vi', 'tr', 'pl', 'nl', 'sv', 'da', 'no',
    // ... other supported languages
  };
  
  static bool isValidLanguage(String language) {
    return _supportedLanguages.contains(language);
  }
  
  static String normalizeLanguage(String language) {
    // Normalize language code
    final normalized = language.toLowerCase().trim();
    
    // Handle special cases
    switch (normalized) {
      case 'zh-cn':
      case 'zh-hans':
        return 'zh';
      case 'zh-tw':
      case 'zh-hant':
        return 'zh';
      default:
        return normalized;
    }
  }
}
```

#### Quality Checker
```dart
class PromptQualityChecker {
  static bool isValidPrompt(String prompt) {
    // Check for emptiness
    if (prompt.isEmpty) return false;
    
    // Check for minimum length
    if (prompt.length < 50) return false;
    
    // Check for keywords
    final keywords = ['summary', '–∏–∑–ª–æ–∂–µ–Ω–∏–µ', 'resumen', 'r√©sum√©'];
    final hasKeywords = keywords.any((keyword) => 
      prompt.toLowerCase().contains(keyword.toLowerCase()));
    
    return hasKeywords;
  }
}
```

### TESTING STRATEGY

#### Unit Tests
```dart
void main() {
  group('LanguagePromptSelector', () {
    test('should return English prompt for unsupported language', () {
      final prompt = LanguagePromptSelector.getPrompt('xyz', 'summary');
      expect(prompt, contains('Create a comprehensive summary'));
    });
    
    test('should return Russian prompt for Russian language', () {
      final prompt = LanguagePromptSelector.getPrompt('ru', 'summary');
      expect(prompt, contains('–°–æ–∑–¥–∞–π—Ç–µ –∫—Ä–∞—Ç–∫–æ–µ –∏–∑–ª–æ–∂–µ–Ω–∏–µ'));
    });
    
    test('should replace variables correctly', () {
      final template = '{{action}} a {{format}}';
      final variables = {'action': 'Create', 'format': 'summary'};
      final result = LanguagePromptSelector._replaceVariables(template, variables);
      expect(result, equals('Create a summary'));
    });
  });
}
```

#### Performance Tests
```dart
void main() {
  group('Performance Tests', () {
    test('should generate prompt in under 1ms', () {
      final stopwatch = Stopwatch()..start();
      LanguagePromptSelector.getPrompt('en', 'summary');
      stopwatch.stop();
      
      expect(stopwatch.elapsedMicroseconds, lessThan(1000));
    });
  });
}
```

### IMPLEMENTATION PLAN

#### Phase 1: Core Algorithm
1. Create LanguagePromptSelector class
2. Implement template system
3. Add variable replacement logic

#### Phase 2: Language Configurations
1. Create language configurations for major languages
2. Add template definitions
3. Implement fallback mechanisms

#### Phase 3: Optimization
1. Add caching system
2. Implement lazy loading
3. Add preloading for popular languages

#### Phase 4: Testing & Validation
1. Comprehensive unit testing
2. Performance testing
3. Quality validation

## üé® CREATIVE CHECKPOINT: Algorithm Design Complete

This algorithm provides an efficient, scalable, and maintainable solution for language-specific prompt generation with optimal performance and comprehensive error handling.

### ALGORITHM FLOW DIAGRAM

```mermaid
graph TD
    A[Language Code] --> B{Valid Language?}
    B -->|Yes| C[Get Language Config]
    B -->|No| D[Use Fallback EN]
    C --> E[Get Template]
    D --> E
    E --> F[Replace Variables]
    F --> G[Cache Result]
    G --> H[Return Prompt]
    
    I[Cache Check] --> J{Cached?}
    J -->|Yes| K[Return Cached]
    J -->|No| A
    
    style A fill:#e1f5fe
    style H fill:#e8f5e8
    style K fill:#fff3e0
```

### SUCCESS METRICS
- Prompt generation completes in under 1ms
- 99.9% success rate for supported languages
- Zero errors for unsupported languages (fallback works)
- Cache hit rate above 80% for popular languages
- Easy addition of new languages (under 5 minutes)
